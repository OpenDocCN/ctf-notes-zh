# CTF-Web历年考题精讲教程 从入门到精通 - P5：反序列化_CVE-2016-7124 - 黑客入门101 - BV14YtkebEbY

Yeah。大家好，我是安玉娥。今天的话呢我们要给大家讲的内容是反系列化CVE2016的7120的这个小bug。好的，这小bu的话考考试的话还是比较多的啊。那在这讲这个之前的话呢。

我们先来访问一下一个网站，在网站真的挺不错啊。好。这个工程师的这个培训啊外包安全培训啊，大家可以过来看一下这里的一些内容啊，一些内容。那么里面分为9个啊19个章章节啊，还有5个实战的项目啊。

那么这些项目啊做完之后呢，就可以提高到你。会提高你很多的。这些挖路洞的能力，还有深透测试的一些。啊，一些提高啊都没有问题的。你把这5个项目实的完之后，做完之后呢，就可以到企业里面上班了，完他没有问题。

完全没有压力。好了。那么我们再回到我们这里给大家讲的。这里的。这里的CVE2016啊，712是这个。的版本。的版本。的版本是5。5625，还有7。0。1010啊。那么这里这里两个一定要记住啊。

现在上在我们的PHP版本，我们看一下是多少。CGB的版本我们看一下啊，47。3。4啊，这个是没有漏洞的啊。那么首先来看一下这个序列化格式啊，序列化格式大家一定要知道的。



![](img/5afc284a53c40a847d8f713e768823ee_1.png)

那么这里这里的话前面没给大家讲啊，那么接下来的话呢，我们找一个例子给大家看看。啊，这里呢有有三个不同的首性面量啊，第一个的话它是一个公共的，第二个它是私有的，第三个是保护的对吧？那我们16化之后。

我们看一下它的。斜列号斜列化之后它的一些结果啊，我们来看一下啊，那这里有个构造函数，Nl团地址，那这边来输出，我们看一下，在这里截截一个包啊，在这里下要端点就可以了。N诺呢我们来访问一下它。



![](img/5afc284a53c40a847d8f713e768823ee_3.png)

![](img/5afc284a53c40a847d8f713e768823ee_4.png)

周里，我们看一下是。铁使啊。好了，我们看一下。这里让他走走走走走来到这里啊。大家看一下这里的内容啊。所里内容是这个样子啊，就这个样子，对吧？没复制出来看一下，看能不能复制出来。但看这里复制不出来了。

这边的话它是有这个。拜分好，连玲。对吧我们看一下这个的话它是一个所有变量，这个的话是一个保护变保护的变量啊，我们来看一下。



![](img/5afc284a53c40a847d8f713e768823ee_6.png)

对吧。好了，我们让他全部走一下，走完之后呢，我们看一下这个页面。这个页面我们看一下原单码，这里都都是有的。但是我们复制的话，就复制不出来啊，因为这些一些乱嘛，复制不出来。



![](img/5afc284a53c40a847d8f713e768823ee_8.png)

这里的话是可以复制的。好了，我们来看一下啊，这边的话呢我们来打开文档。这里呢我们看看到公共的属性啊，公共的属信，我们看一下公共的属性。



![](img/5afc284a53c40a847d8f713e768823ee_10.png)

是哪个是F1对吧？F1。开直为页对吧？那这里还有什么？这里的话，它是大家看到这里，它是大家看一下这里面啊。这里面它是有两个符号的，我们这边的话是没有，所以。



![](img/5afc284a53c40a847d8f713e768823ee_12.png)

![](img/5afc284a53c40a847d8f713e768823ee_13.png)

它原来的话，它应该是这个样子啊，这里的话它是一个保护，所以的话在这边也要加上这个。00对吧？那么保护的话，你要加上这一个。就在哪里加上啊，就在这个地方加上它。系。那原来的话应该是这个样子的。对吧。



![](img/5afc284a53c40a847d8f713e768823ee_15.png)

这个大家一定要记道知道的。好。好了，那么看完这里之后呢，我们来看一下这道题，这道题啊，我们看看啊。

![](img/5afc284a53c40a847d8f713e768823ee_17.png)

![](img/5afc284a53c40a847d8f713e768823ee_18.png)

这样写我们在这里也是有的。也是有的。大家看这里的话有一个类类里面有啊，这个默认这个是有变量，它的默认值为india。然后这边的话它是啊把这个复制。把这个复制过来之后啊，在这边。来读取这个文件。

读取这个文件inestin啊。那么首先呢我们先把这段拿过来。

![](img/5afc284a53c40a847d8f713e768823ee_20.png)

![](img/5afc284a53c40a847d8f713e768823ee_21.png)

啊，这里有个先把它拿过来啊，这边的话呢我们先学绿化一下。好了，这里洗6快就好了啊。

![](img/5afc284a53c40a847d8f713e768823ee_23.png)

![](img/5afc284a53c40a847d8f713e768823ee_24.png)

好啦。再给个。你对是吧。

![](img/5afc284a53c40a847d8f713e768823ee_26.png)

对吧像这边的话就会读取到我们。

![](img/5afc284a53c40a847d8f713e768823ee_28.png)

它读取到应电的内容。这边的话呢，我们因为它这个demo我们读demo吧。它也是一样啊也是一样。大家看一下啊。那这里面啊，假如我们这个改成flash的话呢，我们就可以读到这个flash等于HP对吧？



![](img/5afc284a53c40a847d8f713e768823ee_30.png)

那这道题的话也是我们读这个flash点HP。

![](img/5afc284a53c40a847d8f713e768823ee_32.png)

对吧。这样呢我们现在呢我们看一下。这里传递子flash点PGP啊。我们看一下它怎么走的。好，这里传地址过来。再看这边的话呢更改了这只啊，在这里复制，那后把这个值改变了。好。

这里的话是打开这个fPHP就会得到这个里面的内容，对吧？

![](img/5afc284a53c40a847d8f713e768823ee_34.png)

那我们再来看一下这个返修列款。

![](img/5afc284a53c40a847d8f713e768823ee_36.png)

反序列化的话呢，它首先的话它会有反序列过来之后啊，它是做什么操作啊，他是先来这里给它复制给它复制啊。给他复制。对吧给它复制的时后，就会读到indiaHP里面的内容。那么这这里的话，假因为这里它是斜实的。

因为它是斜时的。然后这这里面啊。这里电的话，你这边的话，你就不能在16块的时候进行这个更改值了。那么这边我们先把序列化拿拿过来，先把序列化拿过来。这里不需要返序列块了，你们要想把它序列块给到我们。



![](img/5afc284a53c40a847d8f713e768823ee_38.png)

好，在这边输出一下。

![](img/5afc284a53c40a847d8f713e768823ee_40.png)

好了。

![](img/5afc284a53c40a847d8f713e768823ee_42.png)

这样就很nice了。我们就会得到16块的内容，对吧？不过这里面还需要并行更改的。因为呢我们它是一个持有变量，所以的话呢我们在这边要加上per了。好。好，复制过来。复制过来的话呢，我们。在这里的团队啊。

这里还有个VR好，在团递这些值我们看一下。

![](img/5afc284a53c40a847d8f713e768823ee_44.png)

![](img/5afc284a53c40a847d8f713e768823ee_45.png)

好得你下个单你。好，刷新。

![](img/5afc284a53c40a847d8f713e768823ee_47.png)

好，大家看走到V看。这里我们是flat点PGP大家看啊这里。就直过来了，再来看看。我看下这这个值有没有变啊。好大家看。它也会变成indes的，大家看它也是变成indes的。对吧。

他并没有就是并没有改改变到这里面的词。

![](img/5afc284a53c40a847d8f713e768823ee_49.png)

那么有什么办法可以要过呀，对吧？这里的话就会用到我们这里的反序列化的这个CVE2016啊，这个小bug这边的话，假如他的再看一下。这里的。这里的值这里的。假如这里面的数组跟后面的不相符的话。

比方说在这里明明是只有一个，我们现在把它改成2。

![](img/5afc284a53c40a847d8f713e768823ee_51.png)

那么他他他就会要过这个检测啊，他会要过这个VVKR这个检测，我们来看一下。

![](img/5afc284a53c40a847d8f713e768823ee_53.png)

这里现在是饿了，我们让他走走走一下。

![](img/5afc284a53c40a847d8f713e768823ee_55.png)

到。

![](img/5afc284a53c40a847d8f713e768823ee_57.png)

我再来试一下啊。

![](img/5afc284a53c40a847d8f713e768823ee_59.png)

好，大家看到这里是没有任何反应，对吧？因为现在的版本是。

![](img/5afc284a53c40a847d8f713e768823ee_61.png)

是多少版本啊，再看一下。因为呢我们的序列化它并不合理，所以的话这边它反序列化是不成功的。我们看一下现在的版本是7。3。4啊，我们把它改成5。2。17。好，现在的话呢，因为呢这个我们是没有做这个。



![](img/5afc284a53c40a847d8f713e768823ee_63.png)

调试没有这个调试环境了，现在的话这里是没有的那所以我们先把。

![](img/5afc284a53c40a847d8f713e768823ee_65.png)

我们来访问一下他，假如他这边的话，假如他这边。能够读到flash的话呢，就表示这个已经成功了。好了，我们试一下。对吧。大家看一下这里大家刚刚应该是这里里面它应该是以一个的一个数组的。

现在我们把它改成两个，改成两个的话呢，我们就可以绕过，我们就可以绕过这个a。

![](img/5afc284a53c40a847d8f713e768823ee_67.png)

The， it other。你就可以要过这个V可打的。

![](img/5afc284a53c40a847d8f713e768823ee_69.png)

很多呢把支付给他。对吧。就会读到里面的内容。好的，这就是这个小bug的一个小利用啊。那么这道题大家去做一下。



![](img/5afc284a53c40a847d8f713e768823ee_71.png)

吓。好了，那么。我们就讲到这里啊。

![](img/5afc284a53c40a847d8f713e768823ee_73.png)

讲到这里了，这节课。那么系列话差不多讲完了啊，下一节课的话，我想一下给大家讲讲什么内容啊。

![](img/5afc284a53c40a847d8f713e768823ee_75.png)

还想讲讲叉叉一，还是给大家讲这些。呃，CTF里面的摄个珠啊。嗯。好了，那么就今天就先到这里啊，下啊明天再给大家讲其他内容了。好了，拜拜。😔。



![](img/5afc284a53c40a847d8f713e768823ee_77.png)