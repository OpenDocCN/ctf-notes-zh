# CTF-Web历年考题精讲教程 从入门到精通 - P6：网鼎杯2020 CTF WEB反序列化解题 - 黑客入门101 - BV14YtkebEbY

Yeah。

![](img/23fcac741fae3115ad8c50754e87ffea_1.png)

你好，我是安妞儿。那么今天啊给大家讲讲这个王顶杯的这个青年组的weber的这个反系列化的一个题目的解析思路。好了，我是安妞尔。那么我们先来访问一个网站，这个网站是我的一些培训啊，大家可以过来看一下。

学习一下。那这里面有很多这些技术啊，hel后假如你对这个有兴趣的话，可以来加这个微信啊来学习啊。啊，这里都很多都是一些高质量的。呃，培训的一些视频啊。有不懂的话，可以私聊按月的，可以得到按月的一些指导。

好了，这里面还有还有什么，还有5个项目存在。这5个项目实际上呢都是很都是平时比较。啊，在一些工作里面。都经常会遇到到的一些技术啊。那么假如你把这5个学项项目做完了。

你基本上到任何一家公司里面上班都是没有问题啊。好的，那么有兴趣的话可以嗯过来了解一下啊。😊，好了，那么今天的内容的话，它是一个晚顶杯的2020啊。这是最这几前做的一条一道题目吧，对吧？

那么这一段代码大家都比较熟悉比较熟悉。好。那么我们来先来访问一下啊，我们访问一下。

![](img/23fcac741fae3115ad8c50754e87ffea_3.png)

好，这道题目的话是读取fld点HP里面的内容。看到呢这里这是。

![](img/23fcac741fae3115ad8c50754e87ffea_5.png)

呃，这里的源代码呢就是当当时的一个呃代码的源码好。那么今天给大家讲讲怎么来讲这道题。

![](img/23fcac741fae3115ad8c50754e87ffea_7.png)

好，首先我们来访问一下这个。呃， demo。点TIT。这里的点某式点某式 in电。好了，这里就是了。对吧当时的话就这个样子，对吧？它这边的话是包含包含f点PP对不对啊？这边的话是访问不到的。

它确实有这个文件，但是它没有访问出来，没访问得到。那么呢。这一段代码给大家分析一下。我们首先看代码的话，看最后啊，一般上面的话都是一些函数。好了。这里的话判断有这个IT啊过来啊。

有的话就前去转为还有这种类型，对吧？这里有个判断，这个判断的话是判断S是K码，到大于32，小于125的。对吧。这里首先你要你的条件要要过这一点。要这点，这里的话具体去检查师幅的。还有一个都不行啊。

有一个都是t，有一个都是force。所以的话这边假如他这个条件过不了的话，后面的话不会再执新了。那么这里过了之后，它这里有个反序列化，反序列化，我们看一下啊，反序列化的话，它这边。他这边的话。

他可能先来到。钱会来到这里，对吧？看它是不是等于。这5他2，对不对？你弄的把这些再调用这个函数。再再用这个函数。点这个函数。好调这个函数，按后这里的话进行判断。它假如呃等于就写入文件写入的话。

我们看一下就写入这段代码的。对吧然后这边为out一个 successcess。那么这里还有差假如等于2的话，它就会读取。读取的话呢，就是这段单码读取内容from内，对吧？读取完之后呢，就把它输入出来。

那么重点的话就在这个地方，这里等于2，怎么让它等于2。对吧。等于这5串2等于这5串2。对吧或者是在PHP它里面有个肉肉类型，比方说这边的话等于2。这边的话也会等于2。这边这两个都是出返回都是出。

所以的话这边假如它等于2就可以了，或者等于字符差2也可以。好了，我们看一下这点。下面这个有个四个函数啊，这个四个函数大家看到这里的话，假如这符串等于2的话，它会给给它一个值等于字个串一，对吧？

乘以这个串一。投先会翻意头先翻二的翻呢。插了他就会来到这里的，它就会来到这里，就会写入这张代码。这边写右文件啊写右文件对吧？那我们先把这段代码。



![](img/23fcac741fae3115ad8c50754e87ffea_9.png)

复制过来。能弄的我们在。再来分析一下啊。

![](img/23fcac741fae3115ad8c50754e87ffea_11.png)

这里的话给他一个啊。这里有dM文件，很no文能复制过来就可以了。这边呢我们还需要。好，大家看啊。😊，这边我们现在的话，因为它这边的话，它是一个反序列化的，我们先把它序列化就先把它序列化出来啊。

先把它数据数列化出来。那么我们这边的话先让它序列化。比方说6一个。列一个这个类啊就可以了。这边的话给他一个边量。等于CC等于6。这边的话要让让他。要拿谁这款。即你其他应个边。看拿诉求比好了。

那么这里的话我们在内外啊，因为这里的话它是个构造函数，它有个固障函数。但是我们的这值的话传就不过来啊，传入不进来。那这里传就传入过来值的话也不会改变这里的值，对吧？那现在的话呢我们。

我们先来看一下它是怎么走的吧。好，先来看一下他怎么走的。

![](img/23fcac741fae3115ad8c50754e87ffea_13.png)

这里面我们先来。

![](img/23fcac741fae3115ad8c50754e87ffea_15.png)

好了。这里怎么又有fH flash的话是in into的加进来了。

![](img/23fcac741fae3115ad8c50754e87ffea_17.png)

我可以先把这张去掉啊。

![](img/23fcac741fae3115ad8c50754e87ffea_19.png)

我再来访问他。好，这里的话实例化实例化才会首先来执行这段代码，它这里等于一，然后这边的话等于这个文件，这里的话就传入R，这里有个hello word。然后这边的话它会调用这个函数，然后他说。走过来之后。

这以判断一判断一的话，他就会做什么，他就会。他就会做什么？这里我们看一下是不是等于一啊，是不是等于一，我们看一下啊。这里大家看呢。他这边。好像是没有值的。这里面没有去，所以的话说说出被 hacker。

对吧好。好，没了。那这边的话它还会调用这个这个函数啊，这个函数。他还是会来到这里来，但是他输突的话也是一样的。



![](img/23fcac741fae3115ad8c50754e87ffea_21.png)

对吧都是边还可。都是背还壳。

![](img/23fcac741fae3115ad8c50754e87ffea_23.png)

能查看原单吗？除它这边还可，大家看它这边还可。佢 jody。这里好像有一些这里有一些是绿化了。有一些序列化是吧？那现在的话呢我们。大家看到这边的话，它是调用D1的。点我们的这个变量的。

所以的话这边假如我们在这边。来设置它。比方说这里的话呢，我们等于2。我们等于2。因为呢我们前面分析分析了这里的。这里的2。这里的二大家看这里这里它是一个，假如它是一个字符转态的话，也是可以触的。

才假如它是一个数值的二，也是可以。进行下面的内容的。所以的话这边我们给他二也可以的对吧？那么他。插大看这里的话。我他应该在反碎列化的时候，才会才应该会调用这个。函数的。那么这边我们先让它等于支付-2吧。

我们看一下16块后面的让它看它怎么执行。这里放内的话，等让它等于当前目录下的这个PHP。好，这里的话可以维空。因为呢我们这边只要让它等于2，然后它就会读取，然后就会输出内容，这并不会写入内容的对吧？



![](img/23fcac741fae3115ad8c50754e87ffea_25.png)

好，在这里的我们先来。食来饭很尴尬。

![](img/23fcac741fae3115ad8c50754e87ffea_27.png)

好，这里调用成功好了。好，这里的话它等于二了。这里它就等于二了。但是它这里等于二的话，它会做什么？它会。假如它等于这5串2的话，在这里它会负值啊。在复制。他会更改这里的值的。好。好。

这时他会写一个文件呢。那所以这里面啊，所以这个地方我们。所以这个字方的话，我们不能让它等于字符和2，我们只要让它等于2就可以了。等于二的话，这边也会执行的也会执行的。那么这里。我们先把这里去掉吧。

这里不用了。好，这里的话就不会等于它这里它不会改变我们这个值了。好，我们先来试一下。

![](img/23fcac741fae3115ad8c50754e87ffea_29.png)

![](img/23fcac741fae3115ad8c50754e87ffea_30.png)

来刷新。好，大家看现在的话，它是等于。它首先的话会运行这这一段内容。吓。大看这里已经在读取了，读取成功了。好，说错错了。对吧已经成功了啊。好了。好，这边的话他还会去执行它执行两遍。第二遍。

但是它这里它读取的话，它是读取不出来。在这读取的话，他应该的目录它不是这个当天目录啊。

![](img/23fcac741fae3115ad8c50754e87ffea_32.png)

他应该是PP里面的一个目录。HP里面的这个目录啊。该是读取的这个目录。

![](img/23fcac741fae3115ad8c50754e87ffea_34.png)

这个没录。好了，那这里面我们看到啊。

![](img/23fcac741fae3115ad8c50754e87ffea_36.png)

我们要走一下，我们拿到这个序列块。好，我们这里的话应该是拿到序列化了。大家看啊这个序列块。我看一下原代码。吓。好，大家看这里的话有一些字符。因为呢我们。这里有些字符我们就打印不出来了，对吧？

我们复制不了。在这里它是这块的话，一般都是什么样的呢？一般假如这边的话，它是一个。他是一个。他是一些。保护的话，它是些保护的话，所以的话它这里啊你要加上什么呢？你要加上百分号00。朋好0连。这里也是。

拜分后连年。本份号00。这里也是的。好，这里也是。大家看一下啊，假如它是保护的话，才要去加在这边加的。因为这边。因为这边呢你。复制不了这个。制服的，所以你要在这里加。



![](img/23fcac741fae3115ad8c50754e87ffea_38.png)

加上去啊，那所以它原来的话它就是这个样子的。对吧这里是反式榴化之后的内容。那么呢我们。把这单拿过来，拿到哪里拿到。打到这边来来到这边来啊。



![](img/23fcac741fae3115ad8c50754e87ffea_40.png)

那我们。现在在这里下个端点。这里呢让他ITR等于什么？Indin。N差等于。要等于这一段啊，我们看一下它过不能不能过得了这里的。



![](img/23fcac741fae3115ad8c50754e87ffea_42.png)

这里的函数第要走。好，这边的话我们看一下这里的话，因为它这边的话执行的比较多啊，所以的话让它撬一下这个函数，大看它撬不了，它跳不了啊，这段代码撬不了，因为它。



![](img/23fcac741fae3115ad8c50754e87ffea_44.png)

这个字符不在。这个字符不在这个区间了，所以的话都这里要不过，对吧？那在PHP。其里面啊它好像是啊支持弱类型的，什么是弱类型的对吧？我们。



![](img/23fcac741fae3115ad8c50754e87ffea_46.png)

我们可以把这里的值改成public。这里可以改成ply。好，全部改成pularly的话呢。

![](img/23fcac741fae3115ad8c50754e87ffea_48.png)

这里就不会出现百分号00这些了。但是它也是可以系列化，然后改变这里面的值的。

![](img/23fcac741fae3115ad8c50754e87ffea_50.png)

好，我们来看一下。

![](img/23fcac741fae3115ad8c50754e87ffea_52.png)

![](img/23fcac741fae3115ad8c50754e87ffea_53.png)

这里我们看一下有没有端点。先把这些全部清掉。

![](img/23fcac741fae3115ad8c50754e87ffea_55.png)

大家看这里的词，它是没有这个符号的。他是没有这个符号的。我先把它拿过来。好了，把这段把这段拿到我们的indus。点HP里面再执行。好了，这里的话就可以了啊。



![](img/23fcac741fae3115ad8c50754e87ffea_57.png)

那么我们现在来到云TS。我看一下他有没有过到这个条件。这个条件看到没有过好，在这里的话，大家看就可以过了。过来之后呢，他来这边。他来这边的话进行这个。反射列话啊，让它。走下一步。下一步的话。

大家看到这里它是先来执行这个。呃，这个函数这边的话，假如它等于2，大家看到啊这里的话我们就传入字数字二的，所以呢这里它不会让它复制。不会让他复制为一好，这里复制肯定是二了。好。这里没有值。

然后它就调用这个它就调这个函数。好，调用这个函数的话，这边我们看到这边的话差是等于什么？我们看一下这边它是等于二的，所以的话这边加二等于一的话，肯定不成功的。他这里的肯定不进去。

那么下面的话才回绕等于2，这里的话它就等于2。大家看。二等于二等于2吗？他去返回去真的，所以的话才会载入到这里来读取下面的内容。好，读去。对吧这里就来到赌局了，这里fed andPHP。好。

这里读取为空。这里读取为空啊。好，那么这里读取为空的话，它有可能。有可能是读取。

![](img/23fcac741fae3115ad8c50754e87ffea_59.png)

呃。我们先来这里看一下，看他有没有读取成功啊。

![](img/23fcac741fae3115ad8c50754e87ffea_61.png)

大家看这里有没有读取成功的。我们来试一下这个函数啊。这个函数。这个fll get函数。好。

![](img/23fcac741fae3115ad8c50754e87ffea_63.png)

我们先拿这里输入出来看一下，它会不会把结果输入出来给我们。大家看这大家看这里它是会的，但是。扎在调试的时候，它并不会。



![](img/23fcac741fae3115ad8c50754e87ffea_65.png)

这一他并没有啊。他并没有输出出来给我们。回到 index。在这里啊，它并没有输出到给我们啊。在这边呢，他并没有收索到给我们。呃，他的。读取函数呢。系。这里应该是个fige。后面再再做一做。



![](img/23fcac741fae3115ad8c50754e87ffea_67.png)

或者不人走了，让他直接访问。Okay。啊。把这单拿过来啊。你看他有没有这个结果范围。大看这里还是没有。那这里还是没有啊，那么我们可以。用这个。用这个。来读取一下。那这边的话我们也可以尝试一下。

给他一个绝对路径。

![](img/23fcac741fae3115ad8c50754e87ffea_69.png)

给他一个绝对路径来看一下啊，这里有呢我们给他一个绝对路径呢，让他来。这边的话我让它生成图绝叠路径，我看它怎么样。



![](img/23fcac741fae3115ad8c50754e87ffea_71.png)

好啦。

![](img/23fcac741fae3115ad8c50754e87ffea_73.png)

啊，大家看这边也是可以读取的。

![](img/23fcac741fae3115ad8c50754e87ffea_75.png)

![](img/23fcac741fae3115ad8c50754e87ffea_76.png)

嗰啲。

![](img/23fcac741fae3115ad8c50754e87ffea_78.png)

你们看一下有没有。你在这边执行吧。啊，这边应该是个D码，不是铁使。

![](img/23fcac741fae3115ad8c50754e87ffea_80.png)

好。但他这边还是能读取的。

![](img/23fcac741fae3115ad8c50754e87ffea_82.png)

好了。你看一下原单码。对吧大家还是能够读取得到的。大家看两期都能读到啊。所以的话这边我们用绝对路径吧。好，嗯把这一段拿过来。然让它放到index里面。



![](img/23fcac741fae3115ad8c50754e87ffea_84.png)

好，两差就行。

![](img/23fcac741fae3115ad8c50754e87ffea_86.png)

好，下个端点。

![](img/23fcac741fae3115ad8c50754e87ffea_88.png)

再跳过去啊。好读去了。好，这里读取了啊，看他有没有读取得到，再看这里的话就能读取到了。好了，就输出了，这里已经有了啊，这里已经可以输出了。



![](img/23fcac741fae3115ad8c50754e87ffea_90.png)

好了。对吧。那这已经可以读到这个fge的。我们看下结果。好，在这里啊在这里还有一个方法，就是用这个来读取。用这个来读机也可以啊，大家可以去试一下啊。你可以用这些字符串来读取这个文件的。

加返回的话是背ta64啊。好，那么。我们现在的话。基本上已经没问题了啊。好，基本上就讲完了。好，那这个题目的话就这么来做啊，里面涉及的内容还是挺多的。它包括的一个肉类型，一个肉类型。

还有反序列化、反序列化，还有它的。dof要用这个组对路径。好了，那我就先到这里吧，我们下节课再给大家大家讲其他的内容吧。好的，拜拜。😊。



![](img/23fcac741fae3115ad8c50754e87ffea_92.png)