# CTF-Web历年考题精讲教程 从入门到精通 - P2：Ctf反序列化_写shell - 黑客入门101 - BV14YtkebEbY

Yeah。我是你，今天我们直接给大家讲这个CDF的吧。那么CDF里面有一个反序列化啊，然后我们可以用它来进行协调。那么序列化的话，它本身它是没有哦这个漏洞的，它需要配合的其他的。

比方说一些模术方法或者一些变量差可控制的情况下，它才会造成漏洞的。那么我们今天来看一下这份代码。这份代码的话呢，我们在这里是有的。



![](img/efee96cfbabe38f351af4e6dcd5b4008_1.png)

我们先把这些都把它删掉吧。好，我们现在来看一下这份代码。好，这里的话它是屏蔽错误啊，然后这里它假如没有直过来的话呢，它就会显示我们这个啊HP的源代码。那这里有个类，类里面有个变量，这个变量的话是123。

这里有个构造函数，这个构造函数在类16块的时候才会做这么一个操作。比方说它这里有个HP文件啊，它会创建这个文件，然后并且把123写到里面来，对吧？那么这里有个codecode的话呢，它是我们可以控制的。

比方说这里有code过来的话呢，它这边有个字符串，字符串里面呢，它看大家看这里有个反序列化，这里的内容假如它是一个序列化的。然后这边的话可以反序列化啊，反序列化。然后呢，他把它的值放到里面来。

然后再把这个值把它。示万掉啊，对吧？那这里的话。假如这个值我们可以控制的话呢，这个值我们可以控制的情况下，我们是可以。把EC些PHP文件啊，把这EC些HHB文代码可以写到这个PHP里面来，对吧？

这里的话就会存在这个漏洞。那么呢我们。我们现在啊。我们先来刷新一下啊这个。嗯。😊，这里面不是我们刚刚删的吗？好，先把这里。好，先把这段代码复制过来啊，我们在这边进行这个测试啊。好，专的代码呢。

我们先把这些的把它放掉。啊，这里也可以放掉。那么现在的话呢，我们来看一下这里的这份代码啊。我们先来访问一下这个代码吧。看一下这边有没有开启这个监清啊。



![](img/efee96cfbabe38f351af4e6dcd5b4008_3.png)

好，没有开启，没有开启的话，那我们打开酷狗浏览器。

![](img/efee96cfbabe38f351af4e6dcd5b4008_5.png)

Demon。到有 c t f。哦，这里。😔，再列个点码。

![](img/efee96cfbabe38f351af4e6dcd5b4008_7.png)

电摩图啊。这里面有个。好，大家看呢现在的话呢，它扣的它是没有。要扣的扣的啊，它是没有直过来的。所以的话这边的话它会显示它的这个源代码。



![](img/efee96cfbabe38f351af4e6dcd5b4008_9.png)

好。

![](img/efee96cfbabe38f351af4e6dcd5b4008_11.png)

对吧。那么还友的。我们来看一下啊，我们先把这一段代码把它复制一下过来。那这边的话呢，我们首先因为这边我们看到它是一个反序列化的，所以的话我们想要控制这个值的时候，我们想要控制这个值。



![](img/efee96cfbabe38f351af4e6dcd5b4008_13.png)

我明。要把它进行这个更改，怎么来更改？第一的话呢可以在上面这里更改。第二的话呢也可以在。累指令化的时候指令化的时候，然后传入一个值。



![](img/efee96cfbabe38f351af4e6dcd5b4008_15.png)

让它更改。那么这里的话呢，你可以这样来投诉吧，有两种方法，那么可以这样啊。好，这里呢我们需要16块这个类。好，石榴花叉。这应该是个6。这里有块class。对吧然后这边的话可以将来。复子。好。

可以这样来复制啊，大家看一下。这里VR的值等于。HP。啊。好，这样的话就可以了。那么现在的话呢，我们来调试一下。现在我们来访问。这里面我们看一下有没有天清。



![](img/efee96cfbabe38f351af4e6dcd5b4008_17.png)

好，减轻。好，大家看到现在的话已经抓到这个调试。

![](img/efee96cfbabe38f351af4e6dcd5b4008_19.png)

好，这里让它走一下，这里的话这里有个构造方法，这个构造方法的话类在16块的时候啊，才会去调用啊。好，这里实6化了。按后这边的话呢，它会往下走，它应该会往下走。我看一下。哦，他先不会往下走啊。

插先去做什么呢？插先去在这里创建123啊，对吧？好，我们让他走一走。做完之后，我们一起做。哦，这里我们。这里的名字不对啊。好，我们让他继续来。来运行。这边我们抓。这里一块。16话，按后这里把值传过来。

我们让它传，对吧？这个值就变了，变成123啊，变成我们的PPin，然后让它。在这里它复值之后啊，他在这里获取到值之后呢，在。在使用这个构造方法，构造方法，然后让它来执行这个操作好。好。

那么现在的话呢我们来看一下页面啊。

![](img/efee96cfbabe38f351af4e6dcd5b4008_21.png)

看一下这里面的页面。这里面的贴题一。还有叉CTF我们看到啊。这里面我们先把它删了啊。

![](img/efee96cfbabe38f351af4e6dcd5b4008_23.png)

好，这里的。现在再来执行。好，让他走过。好，直接运行，运行完之后，这里是没有的。

![](img/efee96cfbabe38f351af4e6dcd5b4008_25.png)

那么他在哪里？他在我们这个PHP里面来的。

![](img/efee96cfbabe38f351af4e6dcd5b4008_27.png)

粘到这个目录啊，因为呢现在的话我们在调试啊，所以的话他还是在调试目录，对吧？

![](img/efee96cfbabe38f351af4e6dcd5b4008_29.png)

那这样就没问题的。

![](img/efee96cfbabe38f351af4e6dcd5b4008_31.png)

好，先把它删了。那么我们怎么怎么把这个数列块拿出来啊。我们可以让他来输出。我让他来出图啊。让再来进行序列化之后再输图。Clas。这里让它输出就可以了。好，这里的就会拿到一个序列款字符串。好，我们看一下。



![](img/efee96cfbabe38f351af4e6dcd5b4008_33.png)

![](img/efee96cfbabe38f351af4e6dcd5b4008_34.png)

对吧这里的话就是我们的这个16画的这个字符串啊。

![](img/efee96cfbabe38f351af4e6dcd5b4008_36.png)

那这里的这里的方法。大家看啊。你可以这么来复制，也可以直接更改这里的内容。因为他这边的话，它是一个。默认是公共的方法呀，你可以在这里进行修改。这边的话，你可以不需要了。这边你可以不需要了，把它去掉。

然后呢它得得到的值的话也是一样的。

![](img/efee96cfbabe38f351af4e6dcd5b4008_38.png)

![](img/efee96cfbabe38f351af4e6dcd5b4008_39.png)

哦，这里面有个。我们先把它去掉吧。

![](img/efee96cfbabe38f351af4e6dcd5b4008_41.png)

![](img/efee96cfbabe38f351af4e6dcd5b4008_42.png)

它也是一样的啊，它的大小值也是一样的。对吧那么你就可以拿这个值过来啊。那呢我们再来看一下这个代码，这个代码呢。



![](img/efee96cfbabe38f351af4e6dcd5b4008_44.png)

哦。

![](img/efee96cfbabe38f351af4e6dcd5b4008_46.png)

好，这个代码我们看一下插的是code的。所以的话呢我们把这个扣拿过来。

![](img/efee96cfbabe38f351af4e6dcd5b4008_48.png)

把这扣拿过来啊，弄呢我们来到。我们来到。好，大家看这里是code对吧？

![](img/efee96cfbabe38f351af4e6dcd5b4008_50.png)

这接扣的。我们先把这个。详金关了。

![](img/efee96cfbabe38f351af4e6dcd5b4008_52.png)

对吧。吓。这里有值。

![](img/efee96cfbabe38f351af4e6dcd5b4008_54.png)

那现在的话呢，我们把这个字符串拿过来啊，这个字符串就是序列化的之后的然后呢大家看到这里它有个反序列化啊，那我们。把这个16块的之后上的给他。给他，然后我们在这边进行这个监清。



![](img/efee96cfbabe38f351af4e6dcd5b4008_56.png)

好，我们来看一下这份代码。好，这里已经转过来了，让他走。大家看到这里的话，就是16块。然弄到这里它反序列化之后啊，反序列化，我们看下走不走。这里是反式掉化之后的这个变量值。他，这里它是什么呢？它是它是。

它是我们class的关系上面我们的内容。那后面的话呢就是我们看一下。后面的话就是我们的这个类啊，大家看到这里的已经在16块了，它跟我们这里一样的，它在16块了。16块之后呢，它会把值传到里面来。

所以我们就可以更改123里面的内容。这是我们的VR这个内容啊，大家看一下。这里的VR等于PG in for了，那这里面的内容就可以进行更改。更改之后呢，它是做什么操作啊。

它是做我们的创建的这个文件然后并且把内容写到里面了。好，我们直接走。对吧他会来到这个构造方法里面。压走这边的话创建，然后这边就写入进来。好。



![](img/efee96cfbabe38f351af4e6dcd5b4008_58.png)

对吧。好，那我们的。

![](img/efee96cfbabe38f351af4e6dcd5b4008_60.png)

我们的什么呢？我们的。文件呢。我们的这个。文件应该写进来了，写到哪里呀，写到我们的PGP里面。这里面啊写到写进来了啊。



![](img/efee96cfbabe38f351af4e6dcd5b4008_62.png)

那么我们不在调试的情况下，这里的话，我们把关闭这个调试啊，让它来访问呢，它就会写到哪里，它就会写到。

![](img/efee96cfbabe38f351af4e6dcd5b4008_64.png)

这个KTTE里面。

![](img/efee96cfbabe38f351af4e6dcd5b4008_66.png)

CDF。Demo。这本就写不进来了啊。

![](img/efee96cfbabe38f351af4e6dcd5b4008_68.png)

对吧。no先把它关掉。再让才来钱有吧。

![](img/efee96cfbabe38f351af4e6dcd5b4008_70.png)

对吧。也是没问题的。好了，那这种的话就是用这个反序列化来写消的。

![](img/efee96cfbabe38f351af4e6dcd5b4008_72.png)

好了，那我们这节课就先到这里，下节课再见，拜拜。😊。

![](img/efee96cfbabe38f351af4e6dcd5b4008_74.png)